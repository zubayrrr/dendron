{"pageProps":{"note":{"id":"mkwoo3ek4y6bnddpy1iteb9","title":"Terraform","desc":"","updated":1658154000010,"created":1653430082985,"custom":{},"fname":"devlog.terraform","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"5807fe7142d7f482ddaee1e706fae96a","links":[{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.IaC","alias":"devlog.IaC","position":{"start":{"line":2,"column":53,"offset":53},"end":{"line":2,"column":67,"offset":67},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.IaC"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.IaC","alias":"devlog.IaC","position":{"start":{"line":4,"column":19,"offset":320},"end":{"line":4,"column":33,"offset":334},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.IaC"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.ansible","alias":"devlog.ansible","position":{"start":{"line":15,"column":4,"offset":997},"end":{"line":15,"column":22,"offset":1015},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.ansible"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.IaaS","alias":"devlog.IaaS","position":{"start":{"line":35,"column":86,"offset":1678},"end":{"line":35,"column":101,"offset":1693},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.IaaS"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.kubernetes","alias":"devlog.kubernetes","position":{"start":{"line":36,"column":59,"offset":1753},"end":{"line":36,"column":80,"offset":1774},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.kubernetes"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.PaaS","alias":"devlog.PaaS","position":{"start":{"line":36,"column":88,"offset":1782},"end":{"line":36,"column":103,"offset":1797},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.PaaS"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.SaaS","alias":"devlog.SaaS","position":{"start":{"line":36,"column":112,"offset":1806},"end":{"line":36,"column":127,"offset":1821},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.SaaS"}},{"type":"wiki","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.IaaS","alias":"devlog.IaaS","position":{"start":{"line":57,"column":78,"offset":2913},"end":{"line":57,"column":93,"offset":2928},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"devlog.IaaS"}},{"type":"ref","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.IaC","position":{"start":{"line":6,"column":1,"offset":397},"end":{"line":6,"column":16,"offset":412},"indent":[]},"xvault":false,"to":{"fname":"devlog.IaC"}},{"type":"ref","from":{"fname":"devlog.terraform","id":"mkwoo3ek4y6bnddpy1iteb9","vaultName":"Dendron"},"value":"devlog.terraform aws","position":{"start":{"line":315,"column":1,"offset":10971},"end":{"line":315,"column":26,"offset":10996},"indent":[]},"xvault":false,"to":{"fname":"devlog.terraform aws"}},{"from":{"fname":"areas.devops","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":142,"column":5,"offset":4201},"end":{"line":142,"column":25,"offset":4221},"indent":[]},"value":"devlog.Terraform","alias":"devlog.Terraform"},{"from":{"fname":"devlog.Packer","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":2,"column":193,"offset":193},"end":{"line":2,"column":213,"offset":213},"indent":[]},"value":"devlog.Terraform","alias":"devlog.Terraform"},{"from":{"fname":"devlog.boto","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":10,"column":41,"offset":262},"end":{"line":10,"column":61,"offset":282},"indent":[]},"value":"devlog.terraform","alias":"devlog.terraform"},{"from":{"fname":"devlog.boto","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":79,"column":3,"offset":1910},"end":{"line":79,"column":23,"offset":1930},"indent":[]},"value":"devlog.terraform","alias":"devlog.terraform"},{"from":{"fname":"devlog.devops interview questions","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":269,"column":106,"offset":12259},"end":{"line":269,"column":126,"offset":12279},"indent":[]},"value":"devlog.terraform","alias":"devlog.terraform"},{"from":{"fname":"devlog.devops interview questions","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":368,"column":4,"offset":16740},"end":{"line":368,"column":24,"offset":16760},"indent":[]},"value":"devlog.terraform","alias":"devlog.terraform"},{"from":{"fname":"devlog.devops interview questions","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":458,"column":31,"offset":20740},"end":{"line":458,"column":51,"offset":20760},"indent":[]},"value":"devlog.Terraform","alias":"devlog.Terraform"},{"from":{"fname":"devlog.ec2 server status check","vaultName":"Dendron"},"type":"backlink","position":{"start":{"line":8,"column":60,"offset":126},"end":{"line":8,"column":80,"offset":146},"indent":[]},"value":"devlog.Terraform","alias":"devlog.Terraform"}],"anchors":{"devlogansible-vs-terraform":{"type":"header","text":"devlog.ansible VS Terraform","value":"devlogansible-vs-terraform","line":21,"column":0,"depth":2},"terraform-architecture":{"type":"header","text":"Terraform Architecture","value":"terraform-architecture","line":27,"column":0,"depth":2},"core":{"type":"header","text":"Core","value":"core","line":31,"column":0,"depth":3},"providers":{"type":"header","text":"Providers","value":"providers","line":39,"column":0,"depth":3},"example-config-files":{"type":"header","text":"Example config files","value":"example-config-files","line":45,"column":0,"depth":2},"terraform-commands-for-different-stages":{"type":"header","text":"Terraform commands for different stages","value":"terraform-commands-for-different-stages","line":53,"column":0,"depth":2},"providers-1":{"type":"header","text":"Providers","value":"providers-1","line":60,"column":0,"depth":2},"resources":{"type":"header","text":"Resources","value":"resources","line":72,"column":0,"depth":2},"data-sources":{"type":"header","text":"Data Sources","value":"data-sources","line":80,"column":0,"depth":2},"terraform-commands":{"type":"header","text":"Terraform Commands","value":"terraform-commands","line":86,"column":0,"depth":2},"examples":{"type":"header","text":"Examples","value":"examples","line":93,"column":0,"depth":2},"creating-an-ec2-instance-with-terraform":{"type":"header","text":"Creating an EC2 instance with Terraform","value":"creating-an-ec2-instance-with-terraform","line":95,"column":0,"depth":3},"changing-resources":{"type":"header","text":"Changing resources","value":"changing-resources","line":128,"column":0,"depth":3},"removingdestroying-resources":{"type":"header","text":"Removing/Destroying resources","value":"removingdestroying-resources","line":171,"column":0,"depth":3},"state":{"type":"header","text":"State","value":"state","line":176,"column":0,"depth":2},"output":{"type":"header","text":"Output","value":"output","line":191,"column":0,"depth":2},"variables":{"type":"header","text":"Variables","value":"variables","line":205,"column":0,"depth":2},"default-values":{"type":"header","text":"Default values","value":"default-values","line":236,"column":0,"depth":3},"type-constraints":{"type":"header","text":"Type constraints","value":"type-constraints","line":240,"column":0,"depth":3},"environment-variables":{"type":"header","text":"Environment Variables","value":"environment-variables","line":290,"column":0,"depth":2},"tf-environment-variable":{"type":"header","text":"TF Environment Variable","value":"tf-environment-variable","line":301,"column":0,"depth":3},"provisioners":{"type":"header","text":"Provisioners","value":"provisioners","line":323,"column":0,"depth":2},"null-resource":{"type":"header","text":"Null resource","value":"null-resource","line":327,"column":0,"depth":3},"connection-attribute":{"type":"header","text":"Connection attribute","value":"connection-attribute","line":339,"column":0,"depth":3},"remote-exec-provisioner":{"type":"header","text":"remote-exec provisioner","value":"remote-exec-provisioner","line":343,"column":0,"depth":3},"local-exec-provisioner":{"type":"header","text":"local-exec provisioner","value":"local-exec-provisioner","line":403,"column":0,"depth":3},"resources-1":{"type":"header","text":"Resources","value":"resources-1","line":409,"column":0,"depth":2}},"children":[],"parent":"9gtn7g40cvqui0sifl1s7t5","data":{}},"body":"<h1 id=\"terraform\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#terraform\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Terraform</h1>\n<p>Terraform is an open source infrastructure as code (<a href=\"/notes/ogswllwu9h5oqeiteyhrtd6\">IaC</a>) software tool that allows DevOps engineers to programmatically provision the physical resources an application requires to run. To create and configure infrastructure . NOT for installing stuff on the server, just for provisioning.</p>\n<p>It is a universal <a href=\"/notes/ogswllwu9h5oqeiteyhrtd6\">IaC</a> tool, works with different cloud providers and technologies.</p>\n<p></p><p></p><div class=\"portal-container\">\n<div class=\"portal-head\">\n<div class=\"portal-backlink\">\n<div class=\"portal-title\">From <span class=\"portal-text-title\">IaC</span></div>\n<a href=\"/notes/ogswllwu9h5oqeiteyhrtd6\" class=\"portal-arrow\">Go to text <span class=\"right-arrow\">→</span></a>\n</div>\n</div>\n<div id=\"portal-parent-anchor\" class=\"portal-parent\" markdown=\"1\">\n<div class=\"portal-parent-fader-top\"></div>\n<div class=\"portal-parent-fader-bottom\"></div><p>Infrastructure as code is an IT practice that manages an application's underlying IT infrastructure through programming. This approach to resource allocation allows developers to logically manage, monitor and provision resources -- as opposed to requiring that an operations team manually configure each required resource.</p>\n<p>Managing infrastructure (servers, network, etc) through definition files rather than manual configuration. Much like <a href=\"/notes/xuy2qlaaas5gxkbjpuierrr\">Configuration Management</a>, this enables automation, consistency, and is self-documenting.</p>\n</div></div><p></p><p></p>\n<p>It uses declarative syntax(as opposed to imperative syntax) to define what the end result looks like and it will figure out how to provision the infrastructure.</p>\n<ul>\n<li>It is also helps in automating the infrastructure as it changes over time.</li>\n<li>To replicate the same infrastructure in different environments(Dev, Staging, Production)</li>\n</ul>\n<p>Using Terraform, your infrastructure is idempotent. You don't need to remember the current state, you only define your desired state. Since, you use declarative syntax, you don't define the steps like you would if you were using imperative syntax.</p>\n<h2 id=\"ansible-vs-terraform\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ansible-vs-terraform\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a><a href=\"/notes/mwyyxjbpi0gztjd00f39biv\">Ansible</a> VS Terraform</h2>\n<ul>\n<li>Terraform is mainly an infrastructure provisioning tool.</li>\n<li>Ansible is mainly used for configuring infrastructure.</li>\n<li>Its a common practice to combine both to get the best of both.</li>\n</ul>\n<h2 id=\"terraform-architecture\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#terraform-architecture\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Terraform Architecture</h2>\n<p>It has 2 components:</p>\n<h3 id=\"core\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#core\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Core</h3>\n<ul>\n<li>Takes 2 input sources\n<ul>\n<li>Terraform Config</li>\n<li>State(current state of the infrastructure)</li>\n</ul>\n</li>\n<li>Core takes the input from the config and state and compares what needs to be changed and what is already there as per the config and state.</li>\n<li>It essentially <strong>creates the execution plan</strong> that the providers use.</li>\n</ul>\n<h3 id=\"providers\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#providers\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Providers</h3>\n<ul>\n<li>This can be providers for the specifc technology(AWS, GCP, Azure, OpenStack, other <a href=\"/notes/au5c3uq0jd84a2tg9oe25ll\">IaaS</a>)</li>\n<li>It can also has providers for higher level technologies(<a href=\"/notes/gbeh61d6hvbmxxy63chp81b\">Kubernetes</a>, other <a title=\"Private\" style=\"color: brown\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\">devlog.PaaS (Private)</a> or even <a title=\"Private\" style=\"color: brown\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\">devlog.SaaS (Private)</a>)</li>\n<li>It has over 100 providers and over 1000 resources.</li>\n</ul>\n<h2 id=\"example-config-files\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#example-config-files\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Example config files</h2>\n<p><img src=\"https://res.cloudinary.com/zubayr/image/upload/v1655346903/wiki/lazrvzt8omhhkplp3xwt.png\"></p>\n<p><img src=\"https://res.cloudinary.com/zubayr/image/upload/v1655346973/wiki/tcxkbpv4dyrx9yjtnufu.png\"></p>\n<p>We only define a few attributes in the configuration file, the rest or defaults are handled by terraform. Auto-generated.</p>\n<h2 id=\"terraform-commands-for-different-stages\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#terraform-commands-for-different-stages\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Terraform commands for different stages</h2>\n<ul>\n<li><code>refresh</code> - query infra provider to get current state.</li>\n<li><code>plan</code> - create an execution plan, just preview no real changes.</li>\n<li><code>apply</code> - executes the plan(it does all the above steps, like refresh and plan and then apply).</li>\n<li><code>destroy</code> - destroys the resources/infrastructure in the right order, does cleaning up of the resources. Reverting. It works similar to <code>apply</code>, it checks the state and makes a plan for what needs to be done.</li>\n</ul>\n<h2 id=\"providers-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#providers-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Providers</h2>\n<ul>\n<li>They're basically a piece of code that knows how to talk to a specific technology. To connect to it and start using. Interact.</li>\n<li>Expose resources for specific technology(AWS, GCP, Azure, OpenStack, other <a href=\"/notes/au5c3uq0jd84a2tg9oe25ll\">IaaS</a>)</li>\n<li>Responsible for understanding API of that platform.</li>\n<li><a href=\"https://registry.terraform.io/browse/providers\">Browse Providers | Terraform Registry</a></li>\n<li>Providers don't come with installation of terraform, they need to be installed separately.</li>\n<li>Once provider is installed using the <code>terraform init</code> command, the complete API of that provider is available.</li>\n<li>You get 2 components from the Providers\n<ul>\n<li>Resources</li>\n<li>Data Sources</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"resources\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#resources\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Resources</h2>\n<ul>\n<li>You can use the <code>resource</code> keyword in your <code>.tf</code> file using the resource's name.</li>\n<li>The name of a resource follows the convention of <code>&#x3C;provider>_&#x3C;resource></code>.</li>\n<li>You can assign the resource to a variable by providing a variable name right after the resource name.</li>\n<li>Each resource block describes one or more infrastructure objects. As referred to as \"attributes\" or \"parameters\".</li>\n<li>When you're creating a resource for another resource that doesn't yet exist, you can reference the object.</li>\n</ul>\n<h2 id=\"data-sources\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#data-sources\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Data Sources</h2>\n<ul>\n<li>Allows data to be fetched for use in the <code>.tf</code> files.</li>\n<li>Query existing resources/components.</li>\n<li>It follows the same convention as the resource names.</li>\n</ul>\n<h2 id=\"terraform-commands\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#terraform-commands\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Terraform Commands</h2>\n<ul>\n<li><code>terraform init</code> - initialize the working directory. Installs the providers defined in the config file.</li>\n<li><code>terraform apply</code> - apply the changes using the configuration file in the working directory.</li>\n<li><code>terraform apply -auto-approve</code> - to skip the approve prompt.</li>\n<li><code>terraform destroy</code> - if <code>-target</code> is not specified, it'll destroy all of the resources defined in the configuration file.</li>\n</ul>\n<h2 id=\"examples\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#examples\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Examples</h2>\n<h3 id=\"creating-an-ec2-instance-with-terraform\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#creating-an-ec2-instance-with-terraform\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Creating an EC2 instance with Terraform</h3>\n<pre class=\"language-json\"><code class=\"language-json\">provider <span class=\"token string\">\"aws\"</span> <span class=\"token punctuation\">{</span>\n  region = <span class=\"token string\">\"us-east-1\"</span>\n  access_key = <span class=\"token string\">\"AKIAJX7X7X7X7X7X7X7X\"</span>\n  secret_key = <span class=\"token string\">\"secret\"</span>\n  <span class=\"token comment\">// don't hard code the above values use Environment variables</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"test_vpc\"</span> <span class=\"token punctuation\">{</span>\n  cidr_block = <span class=\"token string\">\"10.0.0.0/16\"</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnet\"</span> <span class=\"token string\">\"test-subnet-1\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = aws_vpc.test_vpc.id\n  cidr_block = <span class=\"token string\">\"10.0.10.0/24\"</span>\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// if you wanted to create a subnet for an existing vpc, you could hard code the ID of your vpc OR use data sources</span>\n\ndata <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"existing_vpc\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//  use filter or attributes to filter through of your existing vpc/resource</span>\n  default = <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnet\"</span> <span class=\"token string\">\"test-subnet-2\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = data.existing_vpc.id\n  cidr_block = <span class=\"token string\">\"172.31.48.0/20\"</span>\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n</code></pre>\n<h3 id=\"changing-resources\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#changing-resources\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Changing resources</h3>\n<p>Adding names using <code>tags:</code> keyword and using the reserved <code>Name</code> attribute for defining a name.\nTo remove something, you'd simply remove it from the config file.</p>\n<pre class=\"language-json\"><code class=\"language-json\">provider <span class=\"token string\">\"aws\"</span> <span class=\"token punctuation\">{</span>\n  region = <span class=\"token string\">\"us-east-1\"</span>\n  access_key = <span class=\"token string\">\"AKIAJX7X7X7X7X7X7X7X\"</span>\n  secret_key = <span class=\"token string\">\"secret\"</span>\n  <span class=\"token comment\">// don't hard code the above values</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"test_vpc\"</span> <span class=\"token punctuation\">{</span>\n  cidr_block = <span class=\"token string\">\"10.0.0.0/16\"</span>\n  tags = <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> <span class=\"token string\">\"development-vpc\"</span><span class=\"token punctuation\">,</span>\n    vpc_env<span class=\"token operator\">:</span> <span class=\"token string\">\"dev\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnet\"</span> <span class=\"token string\">\"test-subnet-1\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = aws_vpc.test_vpc.id\n  cidr_block = <span class=\"token string\">\"10.0.10.0/24\"</span>\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n    tags = <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> <span class=\"token string\">\"development-subnet\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// if you wanted to create a subnet for an existing vpc, you could hard code the ID of your vpc OR use data sources</span>\n\ndata <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"existing_vpc\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//  use filter or attributes to filter through of your existing vpc/resource</span>\n  default = <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnet\"</span> <span class=\"token string\">\"test-subnet-2\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = data.existing_vpc.id\n  cidr_block = <span class=\"token string\">\"172.31.48.0/20\"</span>\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n</code></pre>\n<h3 id=\"removingdestroying-resources\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#removingdestroying-resources\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Removing/Destroying resources</h3>\n<ol>\n<li>Remove the resource from Terraform config file and <code>terraform apply</code>. (Recommended)</li>\n<li><code>terraform destroy -target resource_type.resource_name</code></li>\n</ol>\n<h2 id=\"state\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#state\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>State</h2>\n<p><code>terraform.tfstate</code> - it is a <code>json</code> file where Terraform stores the state of your managed infrastructure. It generates this file on your first <code>terraform apply</code>.</p>\n<p><code>terraform.tfstate.backup</code> is the file that is created to store the backup of the previous state.</p>\n<p>Neither of these files should be updated manually and must be updated as a result of executing <code>terraform</code> commands.</p>\n<p>Terraform has commands to access the information in the state file.</p>\n<ul>\n<li><code>terraform state</code> - list all subcommands of <code>state</code>.</li>\n<li><code>terraform state list</code> - list all resources in the state.</li>\n<li><code>terraform state mv</code> - move an item in the state.</li>\n<li><code>terraform state show</code> - show a resource in the state. Useful for checking the values of the attributes that were autogenerated by Terraform.</li>\n</ul>\n<h2 id=\"output\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#output\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Output</h2>\n<p>We can define what value we want Terraform to spit at the end of applying of the configuration from the resources. Output values are like function's return values.</p>\n<pre class=\"language-json\"><code class=\"language-json\">output <span class=\"token string\">\"dev-vpc-id\"</span> <span class=\"token punctuation\">{</span>\n  value = aws_vpc.development_vpc.id\n<span class=\"token punctuation\">}</span>\n\noutput <span class=\"token string\">\"dev-subnet-id\"</span> <span class=\"token punctuation\">{</span>\n  value = aws_subnet.dev-subnet<span class=\"token number\">-1</span>.id\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"variables\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#variables\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Variables</h2>\n<p>You use variables inside of the configuration file. variables = input variables. If you don't want to hard code values you can pass them as parameters. Define and reference it. Input variables are like function arguments. They're defined using <code>variable</code> keyword. Makes it easier to replicate, parameterize, and reuse the same configuration over different environments. You'd have different <code>.tfvars</code> files for different environments.</p>\n<pre class=\"language-json\"><code class=\"language-json\">variable <span class=\"token string\">\"subnet_cidr_block\"</span> <span class=\"token punctuation\">{</span>\n  description = <span class=\"token string\">\"CIDR block for the subnet\"</span>\n  default = <span class=\"token string\">\"10.0.30.0/24\"</span>\n  type = string\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"development_vpc\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = aws_vpc.test_vpc.id\n  cidr_block = var.subnet_cidr_block\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n  tags<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-1-dev\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>There are three ways to pass values to input variables.</p>\n<ol>\n<li>Prompt when <code>terraform apply</code> is run.</li>\n<li>Define the value when running apply command\n<ul>\n<li><code>terraform apply -var \"subnet_cidr_block=10.0.30.0/24</code></li>\n</ul>\n</li>\n<li>Use a <code>.tfvars</code> to pass the values from a file. (Recommended)\n<ul>\n<li><code>terraform.tfvars</code> - this is a file that contains the (keys)values for the variables. (If you don't pass a file name, it'll look for this file)</li>\n<li>Use the <code>-var-file</code> flag to pass the file name.\n<ul>\n<li><code>terraform apply -var-file terraform-dev.tfvars</code></li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"default-values\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#default-values\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Default values</h3>\n<p>Default value will kick in if terraform cannot find the value in the <code>.tfvars</code> file or as a command line argument. A default value makes the variable optional.</p>\n<h3 id=\"type-constraints\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#type-constraints\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Type constraints</h3>\n<p><code>type</code> specifies what value types the variable can accept.</p>\n<p>Using <code>list</code>:</p>\n<pre class=\"language-json\"><code class=\"language-json\">variable <span class=\"token string\">\"cidr_blocks\"</span> <span class=\"token punctuation\">{</span>\n  description = <span class=\"token string\">\"CIDR blocks list\"</span>\n  type = list(string)\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnut\"</span> <span class=\"token string\">\"dev-subnet-1\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = aws_vpc.test_vpc.id\n  cidr_block = var.cidr_blocks<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  availability_zone = <span class=\"token string\">\"us-east-1a\"</span>\n  tags<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-1-dev\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>You can also use objects or lists of objects. You can also validate the type of the value for the objects as well.</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// terraform-dev.tfvars</span>\n\ncidr_blocks = <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>cidr_block = <span class=\"token string\">\"10.0.10.0/16\"</span><span class=\"token punctuation\">,</span> name = <span class=\"token string\">\"dev_vpc\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>cidr_block = <span class=\"token string\">\"10.0.20.0/24, name = \"</span>dev_subnet\"<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n<pre class=\"language-json\"><code class=\"language-json\">variable <span class=\"token string\">\"cidr_blocks\"</span> <span class=\"token punctuation\">{</span>\n  description = <span class=\"token string\">\"CIDR blocks list and Name tag\"</span>\n  type = list(object(<span class=\"token punctuation\">{</span>\n    cidr_block<span class=\"token operator\">:</span> string\n    name<span class=\"token operator\">:</span> string\n  <span class=\"token punctuation\">}</span>))\n<span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_vpc\"</span> <span class=\"token string\">\"test_vpc\"</span> <span class=\"token punctuation\">{</span>\n  cidr_block = var.cidr_blocks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>.cidr_block\n  tags = <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> var.cidr_blocks<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>.name\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"environment-variables\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#environment-variables\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Environment Variables</h2>\n<p>Environment variables are defined by the providers for you to use.</p>\n<ol>\n<li>\n<p>Use <code>export</code> to set the environment variable, it will be available only for the current shell session.</p>\n<p><code>export AWS_SECRET_ACCESS_KEY=&#x3C;secret_access_key></code>\n<code>export AWS_ACCESS_KEY_ID=&#x3C;access_key_id></code></p>\n</li>\n<li>\n<p>Set the environment variable in the <code>~/.aws/credentials</code> to be available globally, you may also use <code>aws configure</code> to set the credentials.</p>\n</li>\n</ol>\n<h3 id=\"tf-environment-variable\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#tf-environment-variable\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>TF Environment Variable</h3>\n<p>Define your own custom variables and use <code>.tf_var</code> to pass them to the Terraform configuration as global environment variables.</p>\n<ul>\n<li>Define the variable - <code>export TF_VAR_my_custom_variable=\"my_custom_value\"</code></li>\n<li>To use it, reference it without the <code>TF_VAR_</code> prefix.</li>\n</ul>\n<pre class=\"language-json\"><code class=\"language-json\">variable <span class=\"token string\">\"my_custom_variable\"</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\nresource <span class=\"token string\">\"aws_subnut\"</span> <span class=\"token string\">\"dev-subnet-1\"</span> <span class=\"token punctuation\">{</span>\n  vpc_id = aws_vpc.test_vpc.id\n  cidr_block = var.cidr_blocks<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  availability_zone = var.my_custom_variable\n  tags<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    Name<span class=\"token operator\">:</span> <span class=\"token string\">\"subnet-1-dev\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p></p><p></p><div class=\"portal-container\">\n<div class=\"portal-head\">\n<div class=\"portal-backlink\">\n<div class=\"portal-title\">From <span class=\"portal-text-title\">Terraform in AWS</span></div>\n<a href=\"/notes/bhvn90wgxfjtejvv2t10lvx\" class=\"portal-arrow\">Go to text <span class=\"right-arrow\">→</span></a>\n</div>\n</div>\n<div id=\"portal-parent-anchor\" class=\"portal-parent\" markdown=\"1\">\n<div class=\"portal-parent-fader-top\"></div>\n<div class=\"portal-parent-fader-bottom\"></div><p>In this lab, we'll do:</p>\n<ul>\n<li>Provision an <a href=\"/notes/1h5mmmv2b68di6siwa31jvh\">AWS EC2</a> instance on AWS.</li>\n<li>Run a simple <a href=\"/notes/7jdwsm0maamijwmsnzebbwf\">Nginx</a> <a href=\"/notes/wf37vjntme0oklsx52ycrn4\">Docker</a> container on it.</li>\n<li>We'll do this on AWS infrastructure using Terraform (obviously).</li>\n</ul>\n<h2 id=\"steps\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#steps\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Steps</h2>\n<ol>\n<li>Create custom VPC</li>\n<li>Create custom Subnet</li>\n<li>Create Route table and Internet Gateway.\n<ul>\n<li>To connect the VPC to the internet.</li>\n<li>Allow traffic to and from VPC.</li>\n</ul>\n</li>\n<li>Deploy EC2 instance on the Subnet.</li>\n<li>Deploy ngnix Docker container.</li>\n<li>Create Security Group(Firewall), opening ports.\n<ul>\n<li>In order to access the Web Application.</li>\n<li>And also to SSH into that EC2 server.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"create-vpc-and-subnet\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#create-vpc-and-subnet\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Create VPC and Subnet</h2>\n<pre class=\"language-terraform\"><code class=\"language-terraform\">provider \"aws\" {\n  region = \"eu-central-1\"\n}\n\nvariable vpc_cidr_block {}\nvariable subnet_1_cidr_block {}\nvariable avail_zone {}\nvariable env_prefix {}\nvariable instance_type {}\nvariable ssh_key {}\nvariable my_ip {}\n\ndata \"aws_ami\" \"amazon-linux-image\" {\n  most_recent = true\n  owners      = [\"amazon\"]\n\n  filter {\n    name   = \"name\"\n    values = [\"amzn2-ami-hvm-*-x86_64-gp2\"]\n  }\n\n  filter {\n    name   = \"virtualization-type\"\n    values = [\"hvm\"]\n  }\n}\n\noutput \"ami_id\" {\n  value = data.aws_ami.amazon-linux-image.id\n}\n\nresource \"aws_vpc\" \"myapp-vpc\" {\n  cidr_block = var.vpc_cidr_block\n  tags = {\n      Name = \"${var.env_prefix}-vpc\"\n  }\n\n  # Route table is auto-generated for your VPC by AWS\n  # Default Network ACL - firewall configuration (applied to subnet in that VPC)\n}\n\nresource \"aws_subnet\" \"myapp-subnet-1\" {\n  vpc_id = aws_vpc.myapp-vpc.id\n  cidr_block = var.subnet_1_cidr_block\n  availability_zone = var.avail_zone\n  tags = {\n      Name = \"${var.env_prefix}-subnet-1\"\n  }\n}\n\nresource \"aws_security_group\" \"myapp-sg\" {\n# BTW you can also just use the default SG that was generated when VPC was created\n# resource \"aws_default_security_group\" \"default-sg\" { # you really only need to change this, rest remains the same\n  name   = \"myapp-sg\"\n  vpc_id = aws_vpc.myapp-vpc.id\n\n# Defining traffic rules for firewall\n  ingress {\n    from_port   = 22\n    to_port     = 22 # you can even set a range of ports but we only need 22\n    protocol    = \"tcp\"\n    cidr_blocks = [var.my_ip]\n  }\n\n  ingress {\n    from_port   = 8080\n    to_port     = 8080\n    protocol    = \"tcp\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  egress {\n    # allow any traffic to leave server\n    from_port       = 0\n    to_port         = 0\n    protocol        = \"-1\" # any protocols\n    cidr_blocks     = [\"0.0.0.0/0\"]\n    prefix_list_ids = []\n  }\n\n  tags = {\n    Name = \"${var.env_prefix}-sg\"\n  }\n}\n\nresource \"aws_internet_gateway\" \"myapp-igw\" {\n\tvpc_id = aws_vpc.myapp-vpc.id\n\n    # Think of it as a virtual modem\n    # Even though it has to be created before Route table, you don't necessarily have to put this block before the route table block.\n    # Terraform knows in which sequence it needs to create components.\n    tags = {\n     Name = \"${var.env_prefix}-internet-gateway\"\n   }\n}\n\nresource \"aws_route_table\" \"myapp-route-table\" {\n   vpc_id = aws_vpc.myapp-vpc.id\n\n    # Think of it as a virtual router inside your VPC\n    # Create a new Route table as it is a best practice(not going with the default that comes with VPC creation)\n    # default route, mapping VPC CIDR block to \"local\", created implicitly and cannot be specified.\n   route {\n     cidr_block = \"0.0.0.0/0\"\n     gateway_id = aws_internet_gateway.myapp-igw.id\n   }\n\n   # Route table basically routes traffic within your VPC  (local)\n   # You have to add an Internet Gateway to connect your VPC to the internet\n   # Check \"routes\" in your Route Table for 0.0.0.0/0 (destination) and there has to be an Internet Gateway(as target)\n\n   tags = {\n     Name = \"${var.env_prefix}-route-table\"\n   }\n }\n\n# Associate subnet with Route Table\n# All the resource that will be deployed in the subnet, all the traffic will be handled by the route table once the association has been made.\nresource \"aws_route_table_association\" \"a-rtb-subnet\" {\n  subnet_id      = aws_subnet.myapp-subnet-1.id\n  route_table_id = aws_route_table.myapp-route-table.id\n}\n\n# To use the default route table instead of creating a new one\n\n# resource \"aws_default_route_table\" \"main-rtb\" {\n#   # get default route table id by terraform state show aws_vpc.myapp-vpc(it has to exist) to list all attribute it has\n#   default_route_table_id = aws_vpc.myapp-vpc.default_route_table_id\n#   route {\n#      cidr_block = \"0.0.0.0/0\"\n#      gateway_id = aws_internet_gateway.myapp-igw.id\n#    }\n\n#   tags = {\n#      Name = \"${var.env_prefix}-main-rtb\"\n#    }\n\n# In this case, you don't need to add subnet association as \"main\" route tables as default subnet gets auto-assigned\n# }\n\n\n# automated key generation\nresource \"aws_key_pair\" \"ssh-key\" {\n  key_name   = \"myapp-key\"\n  # public_key = var.my_public_key\n  public_key = file(var.ssh_key) # this should exist locally - you should create it yourself.\n}\n\noutput \"server-ip\" {\n    value = aws_instance.myapp-server.public_ip\n}\n\nresource \"aws_instance\" \"myapp-server\" {\n  # required\n  ami                         = data.aws_ami.amazon-linux-image.id\n  instance_type               = var.instance_type\n\n  # create a public-private key sshing into the EC2 instance, don't forget to `chmod 400 ~/.ssh/.pem` after moving it to `~/.ssh` - this applies only when you manually create it\n\n  key_name                    = \"myapp-key\"\n\n  # optional\n  associate_public_ip_address = true\n  subnet_id                   = aws_subnet.myapp-subnet-1.id\n  vpc_security_group_ids      = [aws_security_group.myapp-sg.id]\n  availability_zone\t\t\t      = var.avail_zone\n\n  tags = {\n    Name = \"${var.env_prefix}-server\"\n  }\n\n  user_data = &#x3C;&#x3C;EOF\n                 #!/bin/bash\n                 apt-get update &#x26;&#x26; apt-get install -y docker-ce\n                 systemctl start docker\n                 usermod -aG docker ec2-user\n                 docker run -p 8080:8080 nginx\n              EOF\n}\n\nresource \"aws_instance\" \"myapp-server-two\" {\n  ami                         = data.aws_ami.amazon-linux-image.id\n  instance_type               = var.instance_type\n  key_name                    = \"myapp-key\"\n  associate_public_ip_address = true\n  subnet_id                   = aws_subnet.myapp-subnet-1.id\n  vpc_security_group_ids      = [aws_security_group.myapp-sg.id]\n  availability_zone\t\t\t      = var.avail_zone\n\n  tags = {\n    Name = \"${var.env_prefix}-server-two\"\n  }\n\n  # you can refer a bash file instead of writing it here\n\n  # doing the below changes will cause your EC2 instance to replaced(destroy and create)\n  # user_data = file(\"entry-script.sh\") # this file has to be located in your terraform dir\n  # Ideally, Terraform should only be used for initial infra setup/management, but for setting up applications and servers, you should probably use something like Ansible or Chef.\n  user_data = &#x3C;&#x3C;EOF\n                 #!/bin/bash\n                 apt-get update &#x26;&#x26; apt-get install -y docker-ce\n                 systemctl start docker\n                 usermod -aG docker ec2-user\n                 docker run -p 8080:8080 nginx\n              EOF\n}\n</code></pre></div></div><p></p><p></p>\n<h2 id=\"provisioners\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#provisioners\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Provisioners</h2>\n<p>Provisioners can be used to model specific actions on the local machine running the Terraform Core or on a remote machine to prepare servers or other infrastructure objects. But HashiCorp states in its documentation that they should be used as the last solution!</p>\n<h3 id=\"null-resource\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#null-resource\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Null resource</h3>\n<p>From the Terraform docs:</p>\n<p>The null provider is a rather-unusual provider that has constructs that intentionally do nothing. This may sound strange, and indeed these constructs do not need to be used in most cases, but they can be useful in various situations to help orchestrate tricky behavior or work around limitations.</p>\n<p>The documentation of each feature of this provider, accessible via the navigation, gives examples of situations where these constructs may prove useful.</p>\n<p>Usage of the null provider can make a Terraform configuration harder to understand. While it can be useful in certain cases, it should be applied with care and other solutions preferred when available.</p>\n<p>The Terraform null_resourceis commonly used to run scripts on a specified trigger.</p>\n<h3 id=\"connection-attribute\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#connection-attribute\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Connection attribute</h3>\n<p><code>remote-exec</code> provisioners require connection credentials to function, even though <code>remote-exec</code> might be defined in a resource block that is a server, it doesn't connect to it unless explicity defined.</p>\n<h3 id=\"remote-exec-provisioner\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#remote-exec-provisioner\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a><code>remote-exec</code> provisioner</h3>\n<p>This provisioner invokes a script on the newly created resource. it’s similar to connecting to the resource and running a bash or a command in the terminal.</p>\n<p>It can be used inside the Terraform resource object and in that case it will be invoked once the resource is created, or it can be used inside a null resource which is my prefered approche as it separates this non terraform behavior from the real terraform behavior.</p>\n<ul>\n<li>Invokes script on a remote resource after it is created\n<ul>\n<li><code>inline</code> - list of commands</li>\n<li><code>script</code> - path to script</li>\n</ul>\n</li>\n</ul>\n<pre class=\"language-terraform\"><code class=\"language-terraform\">resource \"null_resource\" \"configure-vm\" {\n\n  connection {\n      type = \"ssh\"\n      user = var.username\n      host = var.ip_address\n      private_key = var.tls_private_key\n    }\n\n  ## Copy files to VM :\n  provisioner \"file\" {\n    source = \"/Users/zakariaelbazi/Documents/GitHub/zackk8s/kubernetes\" #TODO move to variables.\n    destination = \"/home/${var.username}\"\n  }\n\n  ## install &#x26; start minikube\n  provisioner \"remote-exec\" {\n    inline = [\n      \"sudo chmod +x /home/${var.username}/kubernetes/install_minikube.sh\",\n      \"sh /home/${var.username}/kubernetes/install_minikube.sh\",\n      \"./minikube start --driver=docker\"\n    ]\n  }\n}\n</code></pre>\n<blockquote>\n<p>Note that you can not pass any arguments to the script or command, so the best way is to use file provisioner to copy the files to the resources and then invoke them with the remote-exec provisioner like I did above for my script that installs minikube on the azure-vm.</p>\n</blockquote>\n<blockquote>\n<p>An other thing to pay attention to is that by default, provisioners that fail will also cause the Terraform apply to fail. To avoid that, the on_failure can be used.</p>\n</blockquote>\n<pre class=\"language-terraform\"><code class=\"language-terraform\">resource \"null_resource\" \"configure-vm\" {\n    .........\n    ..........\n\n  provisioner \"remote-exec\" {\n    inline = [\n      \"sudo chmod +x /home/${var.username}/kubernetes/install_minikube.sh\",\n      \"sh /home/${var.username}/kubernetes/install_minikube.sh\",\n      \"./minikube start --driver=docker\"\n    ]\n    on_failure = continue #or fail\n\n  }\n}\n</code></pre>\n<p>In this example, I am using inline which is a series of command, the on_failure will apply only to the final command in the list !</p>\n<h3 id=\"local-exec-provisioner\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#local-exec-provisioner\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a><code>local-exec</code> provisioner</h3>\n<p>Technically, this one is very similar to the one before in terms of behavior or use but it works in the local machine ruining Terraform. It invokes a script or a command on local once the resource it’s declared in is created.</p>\n<p>It’s the only provisioner that doesn’t need any ssh or winrm connection details as it runs locally.</p>\n<h2 id=\"resources-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#resources-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Resources</h2>\n<ul>\n<li><a href=\"https://jhooq.com/terraform-provisioner/\">What is terraform provisioner? | Jhooq</a></li>\n<li><a href=\"https://awstip.com/all-you-need-to-know-about-terraform-provisioners-and-why-you-should-avoid-them-22b5ef8d2db2\">All you need to know about Terraform provisioners and why you should avoid them. | AWS Tip</a></li>\n<li><a href=\"https://www.trendmicro.com/ru_ru/devops/22/c/terraform-tutorial-drift-detection-strategies.html\">Terraform Tutorial: Drift Detection Strategies</a></li>\n</ul>\n<hr>\n<strong>Backlinks</strong>\n<ul>\n<li><a href=\"/notes/522ww47pqvt6y0yj8zparmy\">DevOps</a></li>\n<li><a href=\"/notes/kxbhnz5oxpmort5y94uvqc9\">Packer</a></li>\n<li><a href=\"/notes/e7pods321uz4fxgzzdhf002\">Boto</a></li>\n<li><a href=\"/notes/5eybx5vd339tjnkglx8igde\">Devops Interview Questions</a></li>\n<li><a href=\"/notes/i5wu7j4cvg8tzfyzkawbsjt\">Ec2 Server Status Check using Boto3</a></li>\n</ul>","noteIndex":{"id":"3nfl4nvv516muyzozhcwrw8","title":"/root","desc":"","updated":1655559901157,"created":1637610830605,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"581715455a6f0f7a699209e8521b4acf","links":[{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"archive.about","alias":"my","position":{"start":{"line":4,"column":9,"offset":37},"end":{"line":4,"column":29,"offset":57},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"archive.about"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"tags.areas","alias":"#areas","position":{"start":{"line":20,"column":111,"offset":1051},"end":{"line":20,"column":117,"offset":1057},"indent":[]},"xvault":false,"to":{"fname":"tags.areas"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"tags.areas","alias":"#areas","position":{"start":{"line":21,"column":3,"offset":1198},"end":{"line":21,"column":9,"offset":1204},"indent":[]},"xvault":false,"to":{"fname":"tags.areas"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"swipes","alias":"swipes","position":{"start":{"line":27,"column":3,"offset":1724},"end":{"line":27,"column":13,"offset":1734},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"swipes"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"swipes.quotes","alias":"quotes","position":{"start":{"line":27,"column":48,"offset":1769},"end":{"line":27,"column":72,"offset":1793},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"swipes.quotes"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"swipes.excerpts","alias":"excerpts","position":{"start":{"line":27,"column":74,"offset":1795},"end":{"line":27,"column":102,"offset":1823},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"swipes.excerpts"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"swipes.sayings","alias":"sayings","position":{"start":{"line":27,"column":104,"offset":1825},"end":{"line":27,"column":130,"offset":1851},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"swipes.sayings"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"swipes.phrases","alias":"phrases","position":{"start":{"line":27,"column":132,"offset":1853},"end":{"line":27,"column":158,"offset":1879},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"swipes.phrases"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"resources.people","alias":"others","position":{"start":{"line":27,"column":214,"offset":1935},"end":{"line":27,"column":241,"offset":1962},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"resources.people"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"inbox.webmark","alias":"webmark","position":{"start":{"line":31,"column":235,"offset":2463},"end":{"line":31,"column":260,"offset":2488},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"inbox.webmark"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"slipbox.Ontology","alias":"slipbox.Ontology","position":{"start":{"line":55,"column":3,"offset":3735},"end":{"line":55,"column":23,"offset":3755},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"slipbox.Ontology"}},{"type":"wiki","from":{"fname":"root","id":"3nfl4nvv516muyzozhcwrw8","vaultName":"Dendron"},"value":"archive.about","alias":"About me","position":{"start":{"line":60,"column":3,"offset":3963},"end":{"line":60,"column":29,"offset":3989},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"archive.about"}}],"anchors":{"welcome-to-noetic-noggin":{"type":"header","text":"Welcome to Noetic Noggin","value":"welcome-to-noetic-noggin","line":8,"column":0,"depth":1},"principles":{"type":"header","text":"Principles","value":"principles","line":18,"column":0,"depth":2},"all-notes-should-be-relative-to-me":{"type":"header","text":"All notes should be relative to me.","value":"all-notes-should-be-relative-to-me","line":20,"column":0,"depth":3},"gotta-capture-em-all":{"type":"header","text":"Gotta capture 'em all","value":"gotta-capture-em-all","line":30,"column":0,"depth":3},"dont-force-evolution":{"type":"header","text":"Don't force evolution","value":"dont-force-evolution","line":40,"column":0,"depth":3},"noise--signal":{"type":"header","text":"Noise & Signal","value":"noise--signal","line":45,"column":0,"depth":3},"why-do-any-of-this":{"type":"header","text":"Why do any of this?","value":"why-do-any-of-this","line":50,"column":0,"depth":3},"structure-of-this-wiki":{"type":"header","text":"Structure of this wiki","value":"structure-of-this-wiki","line":59,"column":0,"depth":2},"quicklinks":{"type":"header","text":"Quicklinks","value":"quicklinks","line":64,"column":0,"depth":2}},"children":["0yay2om15bsg2li2p6qgux7","05c4nnjqa92zx11ld6o0ytn","9gtn7g40cvqui0sifl1s7t5","ftbd1hknsd3ocd7jao26tn3","a1kmkdbpclaz5p6sykaw6kc","z121gkmqfo09m8r7jgnpfgn","gkqrr7xbt18xhi93dmjrwzj","ja2x4lrgejr9o9wvit0bd0d","luv39odkfibx3wdosvigwvy","vtvk3bi6o72w58oima9xzf3","yy652kvqrkfn9ipk07m40h4"],"parent":null,"data":{},"body":"\n# Welcome to Noetic Noggin\n\nThis is [[my|archive.about]] personal wiki and a commonplace book; notes by me, for me.\n\n🚧 Permanently under construction 🚧\n\n![](https://res.cloudinary.com/zubayr/image/upload/v1658499909/wiki/ajevkuyebljlxiblyst2.png)\n\nThis wiki was made possible with [dendron.so](https://dendron.so) and [obisidian.md](https://obsidian.md). Stored on [Github Repository](https://github.com/zubayrrr/dendron) and hosted on [Netlify](https://netlify.com) for free.\n\n## Principles\n\n### All notes should be relative to me.\n\n- All notes in principle are written for me; what I know about a subject, how I feel about a particular thing.\n- Opinions are fine as long as I feel strong epistemic confidence in the given opinion.\n- Don't over explain a note if it's not necessary, remember, these notes are for you and are relative to whatever knowledge you posses about the subject.\n- Read books and make an dedicated notes for them.\n- Listen podcasts but capture them inside a \"subject specific\" note or \"Map of Concept\" note or a note tagged #areas. Because making notes from podcasts can be tedious as they're not as well structured as books for consumption.(Whose merit is debatable.)\n- #areas are basically \"Map of Concept\" notes but I have recently come to the realization that its better to maintain them [Nikita Voloboev style](https://wiki.nikiv.dev/) but with heavy usage of transclusion and backlinking.\n  - \"Resources\" should be first processed and then mentioned inside the note, otherwise they should be left in inbox.\n\n### Gotta capture 'em all\n\n- Hog whatever information tickles your pickle([anything that gratifies one's intellectual curiosity](https://news.ycombinator.com/newsguidelines.html)).\n- [[swipes]] are interesting/useful bits of... [[quotes|swipes.quotes]], [[excerpts|swipes.excerpts]], [[sayings|swipes.sayings]], [[phrases|swipes.phrases]]. Essentially, ideas, opinions that are swiped off from [[others|resources.people]].\n- Make no distinction between \"your\" ideas and ideas of \"others\", because if you vibe with an idea; it's already yours.\n- But also remember \"If you've time to consume, you've time to produce.\".\n- Use [raindrop.io](https://raindrop.io) to manage your URL bookmarks.\n- If you need to bookmark a webpage or an article all together, use [MarkDownload](https://chrome.google.com/webstore/detail/markdownload-markdown-web/pcmpcfapbekmbjjkdalcgopdkipoggdi?hl=en-GB) to rip the entire page. Let's call it a [[webmark|inbox.webmark]]; it belong in the `/inbox`.\n- Similar process is employed for capturing tweets using [tweet-to-markdown](https://github.com/kbravh/tweet-to-markdown) and it also belongs in the `/inbox`.\n\n### Don't force evolution\n\n- Let your second brain evolve at it's own pace.\n- The structure should never be _too_ rigid because its meant to take form by itself.\n\n### Noise & Signal\n\n- While capturing ideas left and right is recommended, make sure you're not harming your periods of focus.\n- Have impenetrable focus periods (use Pomodoro method) where you only care about the work on hand and nothing else.\n\n### Why do any of this?\n\n- Because I can't remember everything - there's a lot of information around that interests me and there isn't enough working memory installed in me.\n- So, I make notes - to remember, to create, to meditate, to think.\n- A bodybuilder's portfolio is their body - my portfolio is my wiki.\n- Not only am I making - whatever I know - tangible by writing it down. I know exactly where to look if I ever forget something.\n- I am at the beginning of my learning adventures. When I look back at it, I will know where I came from and how my thoughts evolved over time.\n- Plus, its really fun to nerd out.\n\n## Structure of this wiki\n\n- [[slipbox.Ontology]] explains the structure of this wiki and the tags, backlinks used in it.\n- Dendron takes care of the structure and hierarchy(mostly), but I insist on using tags for backwards compatibility.\n\n## Quicklinks\n\n- [[About me|archive.about]]\n- [Github](https://github.com/zubayrrr)\n- [Twitter](https://twitter.com/zoobhalu)\n- [Blog](https://zubayrali.in)\n- [Guestbook](https://www.yourworldoftext.com/~zubayrali/)\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template","insertNote":{"initialValue":"templates"}},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableHandlebarTemplates":true,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":true},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"theme":"dark","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Noetic Noggin","description":"Personal Wiki / Digital Garden","author":"Zubayr Ali","twitter":"zoobhalu"},"github":{"enableEditLink":false,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"siteUrl":"localhost:3000","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}